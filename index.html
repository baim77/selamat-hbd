<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Happy Birthday</title>
  <style>
    body {
      margin: 0;
      background: linear-gradient(45deg, #1a1a2e, #16213e);
      background-attachment: fixed;
      overflow: hidden;
      font-family: Arial, sans-serif;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
    }
    
    .screen {
      position: absolute;
      top: 0; 
      left: 0;
      width: 100vw;
      height: 100vh;
      transition: opacity 1s ease, transform 1s ease;
      will-change: opacity, transform;
    }
    
    .screen1 {
      display: flex;
      justify-content: center;
      align-items: center;
      flex-direction: column;
    }
    
    .columns {
      display: flex;
      gap: clamp(2px, 1vw, 8px);
      flex-wrap: nowrap;
      margin-bottom: 30px;
    }
    
    .vertical-text {
      font-size: clamp(14px, 2.5vw, 20px);
      font-weight: bold;
      color: #ff1493;
      display: flex;
      flex-direction: column;
      align-items: center;
      font-family: Impact, Arial, sans-serif;
    }
    
    .vertical-text span {
      opacity: 0.3;
      animation: glow 4s infinite;
      animation-delay: calc(0.1s * var(--i));
      will-change: opacity;
    }
    
    @keyframes glow {
      0%, 80% { 
        opacity: 0.3;
      }
      40% { 
        opacity: 1;
        text-shadow: 0 0 10px #ff1493;
      }
    }
    
    button#openBtn {
      margin-top: 20px;
      background: linear-gradient(45deg, #ff1493, #ff69b4);
      border: none;
      border-radius: 25px;
      padding: 12px 24px;
      color: white;
      font-size: 16px;
      font-weight: bold;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 10px;
      transition: transform 0.2s ease;
      will-change: transform;
      -webkit-tap-highlight-color: transparent;
    }
    
    button#openBtn:hover,
    button#openBtn:focus {
      transform: translateY(-2px);
    }

    button#openBtn:active {
      transform: translateY(0);
    }
    
    button .icon {
      width: 20px;
      height: 20px;
      filter: brightness(0) invert(1);
    }

    /* Audio control button */
    .audio-control {
      position: fixed;
      top: 20px;
      right: 20px;
      background: rgba(255, 20, 147, 0.8);
      border: none;
      border-radius: 50%;
      width: 50px;
      height: 50px;
      color: white;
      font-size: 20px;
      cursor: pointer;
      z-index: 1000;
      transition: all 0.3s ease;
      backdrop-filter: blur(10px);
    }

    .audio-control:hover {
      background: rgba(255, 20, 147, 1);
      transform: scale(1.1);
    }

    .audio-control.muted {
      background: rgba(128, 128, 128, 0.8);
    }
    
    .hidden {
      opacity: 0;
      pointer-events: none;
      transform: scale(0.9);
    }
    
    .screen2 {
      background: linear-gradient(135deg, #fff5f5, #fef2f2);
      display: flex;
      justify-content: center;
      align-items: center;
      opacity: 0;
      transform: translateY(20px);
      will-change: opacity, transform;
      padding: 15px;
      box-sizing: border-box;
    }
    
    .screen2.active {
      opacity: 1;
      pointer-events: auto;
      transform: translateY(0);
    }
    
    .note {
      background: linear-gradient(145deg, #fefefe, #f8f8f8);
      padding: clamp(20px, 5vw, 30px);
      width: 100%;
      max-width: 380px;
      max-height: 85vh;
      overflow-y: auto;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
      position: relative;
      border-radius: 12px;
      font-family: Georgia, serif;
      animation: noteAppear 1s ease-out;
      border: 2px solid #ff69b4;
    }

    /* Decorative corner elements */
    .note::before {
      content: "üéâ SELAMAT ULANG TAHUN! üéâ";
      position: absolute;
      top: 10px;
      left: 50%;
      transform: translateX(-50%);
      font-weight: bold;
      color: #ff1493;
      font-size: clamp(10px, 2.5vw, 14px);
      letter-spacing: 1px;
      font-family: Arial, sans-serif;
      z-index: 2;
      white-space: nowrap;
      text-align: center;
      width: 100%;
    }

    /* Decorative flowers */
    .decorative-flowers {
      position: absolute;
      font-size: clamp(16px, 4vw, 20px);
      opacity: 0.3;
      animation: floatDecor 6s ease-in-out infinite;
    }

    .flower-1 { top: 15px; right: 15px; animation-delay: 0s; }
    .flower-2 { bottom: 15px; left: 15px; animation-delay: 2s; }
    .flower-3 { bottom: 15px; right: 15px; animation-delay: 4s; }

    @keyframes floatDecor {
      0%, 100% { transform: translateY(0px) rotate(0deg); }
      50% { transform: translateY(-10px) rotate(10deg); }
    }

    @keyframes noteAppear {
      0% {
        opacity: 0;
        transform: translateY(30px);
      }
      100% {
        opacity: 1;
        transform: translateY(0);
      }
    }
    
    /* Date line */
    .note::after {
      content: "TANGGAL: " attr(data-date);
      position: absolute;
      top: 30px;
      left: 20px;
      font-size: clamp(9px, 2vw, 12px);
      color: #999;
      font-family: Arial, sans-serif;
    }
    
    .note p {
      margin-top: 50px;
      line-height: 1.5;
      background-image: repeating-linear-gradient(
        to bottom, 
        transparent 0px, 
        transparent 20px, 
        rgba(255, 20, 147, 0.1) 21px
      );
      padding-left: 5px;
      color: #333;
      font-size: clamp(12px, 3vw, 14px);
      animation: fadeIn 1.5s ease-out 0.5s both;
    }

    @keyframes fadeIn {
      0% {
        opacity: 0;
      }
      100% {
        opacity: 1;
      }
    }

    /* Simple particles for mobile */
    .particles {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
      z-index: -1;
    }

    .particle {
      position: absolute;
      width: 3px;
      height: 3px;
      background: #ff69b4;
      border-radius: 50%;
      opacity: 0.4;
      animation: floatUp 10s infinite linear;
    }

    @keyframes floatUp {
      0% {
        transform: translateY(100vh);
        opacity: 0;
      }
      10%, 90% {
        opacity: 0.4;
      }
      100% {
        transform: translateY(-10vh);
        opacity: 0;
      }
    }

    /* Mobile optimizations */
    @media (max-width: 768px) {
      .columns {
        gap: 2px;
      }
      
      .note {
        margin: 10px;
        padding: 20px 15px;
        max-height: 80vh;
      }

      .note p {
        margin-top: 45px;
        line-height: 1.4;
      }

      /* Reduce animations on mobile */
      .vertical-text span {
        animation-duration: 6s;
      }

      /* Disable some effects on very small screens */
      @media (max-width: 480px) {
        .particle {
          display: none;
        }
        
        button#openBtn:hover {
          transform: none;
        }

        .note {
          max-height: 75vh;
        }
      }
    }

    /* Reduce motion for users who prefer it */
    @media (prefers-reduced-motion: reduce) {
      .vertical-text span {
        animation: none;
        opacity: 1;
      }
      
      .particle {
        display: none;
      }
      
      .screen,
      .note,
      button#openBtn {
        transition: none;
        animation: none;
      }
    }

    /* Performance optimizations */
    .vertical-text,
    .screen,
    .note,
    button#openBtn {
      backface-visibility: hidden;
      -webkit-backface-visibility: hidden;
    }

    /* Touch improvements */
    button#openBtn {
      min-height: 44px; /* iOS touch target */
      touch-action: manipulation;
    }
  </style>
</head>
<body>
  <div class="particles" id="particles"></div>

  <!-- Audio control button -->
  <button class="audio-control" id="audioControl" title="Play/Pause Music">üéµ</button>

  <!-- Audio element with multiple sources -->
  <audio id="backgroundAudio" loop preload="auto">
    <source src="https://www.soundjay.com/misc/sounds/happy-birthday-song.mp3" type="audio/mpeg">
    <source src="https://www.soundjay.com/misc/sounds/happy-birthday-song.ogg" type="audio/ogg">
    <source src="lagu.mp3" type="audio/mpeg">
    <!-- Fallback untuk file lokal jika ada -->
  </audio>

  <div id="screen1" class="screen screen1">
    <div class="columns">
      <!-- Will be generated by JS -->
    </div>
    <button id="openBtn">
      <img src="https://cdn-icons-png.flaticon.com/512/833/833472.png" alt="Gift" class="icon">
      Buka Hadiah
    </button>
  </div>

  <div id="screen2" class="screen screen2 hidden">
    <div class="note" data-date="">
      <div class="decorative-flowers flower-1">üå∏</div>
      <div class="decorative-flowers flower-2">üå∫</div>
      <div class="decorative-flowers flower-3">üåº</div>
      <p>
        ‚ú® Selamat ulang tahun yaaa! üéÇ<br/><br/>
        
        Sorry banget nih baru bikin kartu digitalnya sekarang üòÖ Better late than never kan? hehe üéÅ<br/><br/>
        
        Wah udah bertambah tua nih! Semoga di usia yang baru ini U makin sehat, bahagia, dan semua yang U mau bisa terwujud ya! ‚ú®<br/><br/>
        
        Makasih udah jadi temen yang asik banget! Bisa diajak ngobrol apa aja dan selalu bikin suasana jadi fun! üòä<br/><br/>
        
        Semoga tahun ini banyak kejadian seru dan makin banyak momen yang gak bakal terlupa! üéà<br/><br/>
        
        Tetep jadi orang keren kayak gini ya! üòéüí´<br/>
        ~ Dari ur Friend ~
      </p>
    </div>
  </div>

  <script>
    const columnsContainer = document.querySelector(".columns");
    const openBtn = document.getElementById("openBtn");
    const screen1 = document.getElementById("screen1");
    const screen2 = document.getElementById("screen2");
    const particlesContainer = document.getElementById("particles");
    const audioControl = document.getElementById("audioControl");
    const backgroundAudio = document.getElementById("backgroundAudio");

    // Check if device is mobile
    const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
    const isLowEnd = navigator.hardwareConcurrency <= 2 || navigator.deviceMemory <= 2;

    // Audio control
    let isPlaying = false;
    let audioReady = false;

    // Set audio volume
    backgroundAudio.volume = 0.3;

    // Audio event listeners
    backgroundAudio.addEventListener('canplaythrough', function() {
      audioReady = true;
      console.log('Audio ready to play');
    });

    backgroundAudio.addEventListener('error', function(e) {
      console.log('Audio error:', e);
      audioControl.style.display = 'none'; // Hide button if audio fails
    });

    // Audio control button
    audioControl.addEventListener('click', function() {
      if (!audioReady) {
        console.log('Audio not ready yet');
        return;
      }

      if (isPlaying) {
        backgroundAudio.pause();
        audioControl.textContent = 'üîá';
        audioControl.classList.add('muted');
        isPlaying = false;
      } else {
        backgroundAudio.play().then(() => {
          audioControl.textContent = 'üéµ';
          audioControl.classList.remove('muted');
          isPlaying = true;
        }).catch(error => {
          console.log('Error playing audio:', error);
        });
      }
    });

    // Try to start audio when user interacts with the page
    function startAudioOnInteraction() {
      if (!audioReady || isPlaying) return;
      
      backgroundAudio.play().then(() => {
        audioControl.textContent = 'üéµ';
        audioControl.classList.remove('muted');
        isPlaying = true;
        console.log('Audio started automatically');
      }).catch(error => {
        console.log('Autoplay prevented:', error);
        // Show a hint to user
        audioControl.style.animation = 'pulse 2s infinite';
      });
    }

    // Set current date
    const today = new Date();
    const dateStr = today.toLocaleDateString('id-ID', { 
      day: 'numeric', 
      month: 'long', 
      year: 'numeric' 
    });
    document.querySelector('.note').setAttribute('data-date', dateStr);

    // Generate vertical text
    const totalColumns = isMobile ? 12 : 18;
    const text = "HAPPYBIRTHDAY";

    for (let c = 0; c < totalColumns; c++) {
      const col = document.createElement("div");
      col.className = "vertical-text";

      for (let i = 0; i < text.length; i++) {
        const span = document.createElement("span");
        span.textContent = text[i];
        span.style.setProperty("--i", i + 1);
        col.appendChild(span);
      }

      columnsContainer.appendChild(col);
    }

    // Create particles
    function createParticles() {
      const particleCount = isMobile ? 10 : isLowEnd ? 8 : 20;
      
      for (let i = 0; i < particleCount; i++) {
        const particle = document.createElement("div");
        particle.className = "particle";
        particle.style.left = Math.random() * 100 + "%";
        particle.style.animationDelay = Math.random() * 10 + "s";
        particle.style.animationDuration = (Math.random() * 5 + 8) + "s";
        
        particlesContainer.appendChild(particle);
      }
    }

    // Only create particles if not on very small screens
    if (window.innerWidth > 480 && !window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
      createParticles();
    }

    // Transition function
    openBtn.addEventListener("click", () => {
      // Try to start audio on user interaction
      startAudioOnInteraction();
      
      // Haptic feedback on mobile
      if (navigator.vibrate) {
        navigator.vibrate(50);
      }
      
      screen1.classList.add("hidden");
      setTimeout(() => {
        screen2.classList.add("active");
      }, 100);
    });

    // Add click listener to document to try starting audio
    document.addEventListener('click', startAudioOnInteraction, { once: true });

    // Performance monitoring
    let frameCount = 0;
    let lastTime = performance.now();

    function checkPerformance() {
      frameCount++;
      const currentTime = performance.now();
      
      if (currentTime - lastTime >= 1000) {
        const fps = frameCount;
        frameCount = 0;
        lastTime = currentTime;
        
        // If FPS is too low, reduce particles
        if (fps < 30 && particlesContainer.children.length > 5) {
          const particles = particlesContainer.querySelectorAll('.particle');
          for (let i = particles.length - 1; i >= Math.floor(particles.length / 2); i--) {
            particles[i].remove();
          }
        }
      }
      
      requestAnimationFrame(checkPerformance);
    }

    // Start performance monitoring
    if (!isMobile) {
      requestAnimationFrame(checkPerformance);
    }

    // Add pulse animation for audio button hint
    const style = document.createElement('style');
    style.textContent = `
      @keyframes pulse {
        0% { transform: scale(1); }
        50% { transform: scale(1.1); }
        100% { transform: scale(1); }
      }
    `;
    document.head.appendChild(style);
  </script>
</body>
</html>